<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Admin Panel</title>

<style>
body{background:#0b0b0c;color:white;font-family:Inter;padding:20px;}
button{
  width:100%;padding:14px;background:#2B7FFF;border:none;border-radius:10px;
  margin-bottom:20px;font-size:17px;color:white;font-weight:600;
}
.entry{
  background:#111;padding:16px;border-radius:12px;margin-top:16px;
}
.entry small{color:#aaa;}
</style>
</head>

<body>

<h2>All Recruiter Entries</h2>

<button onclick="downloadCSV()">Download CSV</button>

<div id="logs"></div>

<script type="module">
import { auth, db } from "./firebase.js";
import {
  collection, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

let all = [];

// LIVE FETCH of all logs
onSnapshot(collection(db,"callLogs"),(snap)=>{
  let logs=document.getElementById("logs");
  logs.innerHTML="";
  all=[];

  snap.forEach(doc=>{
    let d=doc.data();
    all.push(d);

    logs.innerHTML+=`
      <div class="entry">
        <small>${new Date(d.ts).toLocaleString()}</small><br>
        <b>${d.name}</b><br>
        ${d.number}<br>
        ${d.age}, ${d.loc}<br>
        CTC: ${d.ctc}<br>
        ${d.comp}<br>
        Channel: ${d.channel}<br>
        Remarks: ${d.remarks}<br>
        Recruiter UID: ${d.uid}
      </div>
    `;
  });
});

// CSV DOWNLOAD
function downloadCSV(){
  let csv="Timestamp,Name,Number,Age,Location,CTC,Company,Channel,Remarks,UID\n";

  all.forEach(d=>{
    csv+=`${d.ts},${d.name},${d.number},${d.age},${d.loc},${d.ctc},${d.comp},${d.channel},${d.remarks},${d.uid}\n`;
  });

  let blob=new Blob([csv],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Recruita_Data.csv";
  a.click();
}

// ðŸ”¥ FIX: Make function global for button onclick
window.downloadCSV = downloadCSV;

</script>

</body>
</html>
